 ç”¨java spring bootå†™ä¸€ä¸ªç®€å•çš„åå°åŠŸèƒ½ï¼Œéœ€è¦æœ‰æ³¨å†Œã€ç™»å½•ã€æ–°å»ºã€ä¿®æ”¹ã€åˆ é™¤ã€æŸ¥è¯¢ã€ä¸Šä¼ ç­‰åŠŸèƒ½ï¼Œç”¨æˆ·è¦åŒºåˆ†ç®¡ç†å‘˜ä¸æ™®é€šç”¨æˆ·æƒé™ï¼Œç®¡ç†å‘˜å¯ä»¥åšä»»ä½•æ“ä½œï¼Œæ™®é€šç”¨æˆ·åªèƒ½è¯„è®ºï¼Œå¹¶ç»™å‡ºç›¸å¯¹åº”çš„mysqlæ•°æ®åº“è¡¨ç»“æ„ 



DeepSeek-R1æ»¡è¡€ç‰ˆ
æ€è€ƒå®Œæˆ

å¥½çš„ï¼Œç”¨æˆ·ä¹‹å‰è®©æˆ‘ç”¨Java Spring Bootå†™ä¸€ä¸ªåŒ…å«æ³¨å†Œã€ç™»å½•ã€CRUDã€ä¸Šä¼ åŠŸèƒ½çš„åå°ï¼Œå¹¶ä¸”åŒºåˆ†ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·çš„æƒé™ï¼Œè¿˜è¦æ±‚å¯¹åº”çš„MySQLæ•°æ®åº“è¡¨ç»“æ„ã€‚ç°åœ¨ç”¨æˆ·çš„é—®é¢˜æ˜¯è¦æ±‚è¯¦ç»†å®ç°æ­¥éª¤ã€‚æˆ‘éœ€è¦å…ˆç†æ¸…ä¹‹å‰çš„å›ç­”ç»“æ„ï¼Œç¡®ä¿è¿™æ¬¡è¯¦ç»†æ­¥éª¤è¦†ç›–æ‰€æœ‰å¿…è¦çš„ç¯èŠ‚ï¼ŒåŒæ—¶ä¿æŒé€»è¾‘æ¸…æ™°ã€‚

é¦–å…ˆï¼Œå›é¡¾ä¹‹å‰çš„å›ç­”ï¼Œæˆ‘ç»™å‡ºäº†ä»£ç ç‰‡æ®µã€æ•°æ®åº“ç»“æ„å’Œä¸€äº›å»ºè®®ï¼Œä½†æ­¥éª¤ä¸å¤Ÿè¯¦ç»†ã€‚ç°åœ¨ç”¨æˆ·éœ€è¦å…·ä½“çš„å®ç°æ­¥éª¤ï¼Œæ‰€ä»¥éœ€è¦åˆ†é˜¶æ®µè®²è§£ï¼Œå¯èƒ½åŒ…æ‹¬é¡¹ç›®æ­å»ºã€å®ä½“ç±»ã€Repositoryã€å®‰å…¨é…ç½®ã€ä¸šåŠ¡é€»è¾‘ã€æƒé™æ§åˆ¶ã€æ–‡ä»¶ä¸Šä¼ ã€æµ‹è¯•ç­‰ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦åˆ†æç”¨æˆ·çš„éœ€æ±‚æ˜¯å¦æœ‰æ—¶é—´æ•æ„Ÿæ€§ã€‚ç”¨æˆ·æåˆ°å¦‚æœæœ‰æ—¶æ•ˆæ€§éœ€æ±‚ï¼Œä½¿ç”¨2025å¹´2æœˆ26æ—¥ï¼Œä½†å½“å‰é—®é¢˜æ²¡æœ‰æ˜æ˜¾çš„æ—¶é—´ä¾èµ–ï¼Œæ‰€ä»¥ä¸éœ€è¦è°ƒæ•´æ—¶é—´ç›¸å…³çš„å†…å®¹ã€‚

ç„¶åï¼Œç¡®å®šå›ç­”æ ¼å¼ã€‚ç”¨æˆ·å¸Œæœ›æ­¥éª¤è¯¦ç»†ï¼Œå¯èƒ½éœ€è¦åˆ†æ­¥éª¤ã€å­æ­¥éª¤ï¼Œä½¿ç”¨æ ‡é¢˜ã€ä»£ç å—ã€åˆ—è¡¨ç­‰ï¼Œä¿æŒç¾è§‚å’Œå¯è¯»æ€§ã€‚å¯èƒ½ç”¨æ­¥éª¤ç¼–å·ï¼Œæ¯ä¸ªæ­¥éª¤ä¸‹åˆ†è¦ç‚¹ï¼Œæ¯”å¦‚ç¯å¢ƒå‡†å¤‡ã€åˆ›å»ºå®ä½“ã€é…ç½®å®‰å…¨ã€å®ç°APIç­‰ã€‚

æ¥ä¸‹æ¥ï¼Œè¯¦ç»†æ­¥éª¤çš„è§„åˆ’ï¼š

ç¯å¢ƒå‡†å¤‡ï¼šJDKã€Mavenã€IDEã€MySQLã€Postmanç­‰å·¥å…·ï¼Œåˆ›å»ºSpring Booté¡¹ç›®ï¼Œæ·»åŠ ä¾èµ–ï¼Œæ¯”å¦‚Spring Web, Security, Data JPA, MySQL, JWT, Lombokç­‰ã€‚

æ•°æ®åº“è®¾è®¡ï¼šæ ¹æ®ä¹‹å‰çš„è¡¨ç»“æ„ï¼Œå»ºè¡¨è¯­å¥å¯èƒ½éœ€è¦è¯¦ç»†è¯´æ˜ï¼Œæˆ–è€…å¼•ç”¨ä¹‹å‰çš„SQLã€‚

å®ä½“ç±»å®ç°ï¼šUserã€Postã€Commentã€Fileç­‰ï¼Œä½¿ç”¨JPAæ³¨è§£ï¼Œæ³¨æ„å…³è”å…³ç³»å¦‚@ManyToOneã€‚

Repositoryå±‚ï¼šåˆ›å»ºå¯¹åº”çš„JPA Repositoryæ¥å£ï¼Œå¯èƒ½åŒ…æ‹¬è‡ªå®šä¹‰æŸ¥è¯¢æ–¹æ³•ã€‚

å®‰å…¨é…ç½®ï¼šSpring Securityçš„é…ç½®ç±»ï¼ŒJWTè®¤è¯æµç¨‹ï¼ŒåŒ…æ‹¬JwtUtilã€è¿‡æ»¤å™¨ã€ç”¨æˆ·è¯¦ç»†æœåŠ¡ç­‰ã€‚

ç”¨æˆ·è®¤è¯ï¼šæ³¨å†Œå’Œç™»å½•çš„APIå®ç°ï¼Œå¯†ç åŠ å¯†ï¼ŒJWTç”Ÿæˆã€‚

ä¸šåŠ¡é€»è¾‘å®ç°ï¼šå„ä¸ªæ§åˆ¶å™¨çš„CRUDæ“ä½œï¼Œæƒé™æ§åˆ¶å¦‚@PreAuthorizeæ³¨è§£çš„ä½¿ç”¨ï¼ŒåŒºåˆ†ç®¡ç†å‘˜å’Œç”¨æˆ·æƒé™ã€‚

æ–‡ä»¶ä¸Šä¼ ï¼šå®ç°æ–‡ä»¶ä¸Šä¼ çš„æ§åˆ¶å™¨ï¼Œå¤„ç†MultipartFileï¼Œå­˜å‚¨è·¯å¾„ï¼Œæ•°æ®åº“è®°å½•ã€‚

å…¨å±€å¼‚å¸¸å¤„ç†ï¼šä½¿ç”¨@ControllerAdviceå¤„ç†å¼‚å¸¸ï¼Œè¿”å›ç»Ÿä¸€æ ¼å¼çš„é”™è¯¯å“åº”ã€‚

æµ‹è¯•ä¸éªŒè¯ï¼šç”¨Postmanæµ‹è¯•å„ä¸ªæ¥å£ï¼Œç¡®ä¿æƒé™æ§åˆ¶å’ŒåŠŸèƒ½æ­£å¸¸ã€‚

åœ¨æ­¥éª¤ä¸­éœ€è¦æ’å…¥å…³é”®ä»£ç ç¤ºä¾‹ï¼Œæ¯”å¦‚å®ä½“ç±»ã€å®‰å…¨é…ç½®ã€æ§åˆ¶å™¨æ–¹æ³•ï¼Œä½†ä¸è¦è¿‡å¤šï¼Œä¿æŒç®€æ´ã€‚åŒæ—¶ï¼Œæ³¨æ„æƒé™æ§åˆ¶éƒ¨åˆ†ï¼Œæ¯”å¦‚ç®¡ç†å‘˜æ‰èƒ½è®¿é—®çš„æ¥å£ï¼Œæ™®é€šç”¨æˆ·çš„è¯„è®ºæƒé™ç­‰ã€‚

è¿˜éœ€è¦è€ƒè™‘å¯†ç åŠ å¯†ï¼Œä½¿ç”¨BCryptï¼Œåœ¨ç”¨æˆ·æ³¨å†Œæ—¶å¤„ç†ã€‚JWTçš„ç”Ÿæˆå’ŒéªŒè¯æµç¨‹éœ€è¦è¯¦ç»†è¯´æ˜ï¼ŒåŒ…æ‹¬è¿‡æ»¤å™¨çš„é…ç½®ã€‚

æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†éœ€è¦æåˆ°å­˜å‚¨æ–¹å¼ï¼Œå¯èƒ½æœ¬åœ°å­˜å‚¨æˆ–äº‘å­˜å‚¨ï¼Œç¤ºä¾‹ä¿å­˜åˆ°æœ¬åœ°ç›®å½•ï¼Œå¹¶åœ¨æ•°æ®åº“ä¸­è®°å½•æ–‡ä»¶ä¿¡æ¯ã€‚

æµ‹è¯•æ­¥éª¤è¦æŒ‡å¯¼ç”¨æˆ·å¦‚ä½•æµ‹è¯•å„ä¸ªæ¥å£ï¼Œæ¯”å¦‚æ³¨å†Œã€ç™»å½•åè·å–tokenï¼Œä½¿ç”¨tokenè®¿é—®å—ä¿æŠ¤çš„APIï¼ŒéªŒè¯æƒé™æ˜¯å¦æ­£ç¡®ã€‚

æœ€åï¼Œç¡®ä¿æ­¥éª¤é€»è¾‘è¿è´¯ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½è¦†ç›–å¿…è¦çš„ç»†èŠ‚ï¼ŒåŒæ—¶ä¸è¿‡äºå†—é•¿ã€‚å¯èƒ½è¿˜éœ€è¦æç¤ºç”¨æˆ·æ³¨æ„äº‹é¡¹ï¼Œå¦‚é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€JWTå¯†é’¥è®¾ç½®ç­‰ã€‚

æ ¹æ®å½“å‰éœ€æ±‚ï¼ˆæ— æ—¶æ•ˆæ€§ä¾èµ–ï¼‰ï¼Œä»¥ä¸‹æ˜¯åˆ†æ­¥å®ç°æ–¹æ¡ˆï¼Œé‡‡ç”¨æ¨¡å—åŒ–åˆ†å±‚æ¶æ„è®¾è®¡ï¼š

ä¸€ã€ç¯å¢ƒå‡†å¤‡ï¼ˆå…±4æ­¥ï¼‰
bash
Copy Code
# 1. ä½¿ç”¨Spring Initializråˆ›å»ºé¡¹ç›®
Dependencies:
- Spring Web
- Spring Security
- Spring Data JPA
- MySQL Driver
- Lombok
- JWT (æ‰‹åŠ¨æ·»åŠ )

# 2. æ‰‹åŠ¨æ·»åŠ ä¾èµ–ï¼ˆpom.xmlï¼‰
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>0.11.5</version>
</dependency>

# 3. æ•°æ®åº“é…ç½®ï¼ˆapplication.ymlï¼‰
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/cms_db?useSSL=false
    username: root
    password: your_password
  jpa:
    hibernate.ddl-auto: update

# 4. åˆ›å»ºMySQLæ•°æ®åº“
CREATE DATABASE cms_db CHARACTER SET utf8mb4;

äºŒã€æ ¸å¿ƒæ¨¡å—å®ç°æ­¥éª¤
1. å®‰å…¨è®¤è¯æ¨¡å—
java
Copy Code
// JWTå·¥å…·ç±»
public class JwtUtil {
    private static final String SECRET_KEY = "your-256-bit-secret";
   
    public static String generateToken(UserDetails user) {
        return Jwts.builder()
                .setSubject(user.getUsername())
                .claim("roles", user.getAuthorities())
                .setIssuedAt(new Date())
                .setExpiration(new Date(System.currentTimeMillis() + 86400000)) // 24h
                .signWith(SignatureAlgorithm.HS256, SECRET_KEY)
                .compact();
    }
}

// JWTè¿‡æ»¤å™¨
public class JwtFilter extends OncePerRequestFilter {
    // å®ç°tokenè§£æä¸éªŒè¯é€»è¾‘
}

2. ç”¨æˆ·ç®¡ç†æ¨¡å—
java
Copy Code
// æ³¨å†ŒDTO
public record RegisterRequest(
        @NotBlank String username,
        @Size(min=8) String password,
        String role) {}

// ç”¨æˆ·æœåŠ¡
@Service
public class UserService {
    @Autowired
    private PasswordEncoder encoder;
    
    public User registerUser(RegisterRequest request) {
        if(request.role() == null) request = new RegisterRequest(request.username(), request.password(), "USER");
        
        return userRepository.save(
            new User(request.username(), 
                    encoder.encode(request.password()),
                    request.role())
        );
    }
}

ä¸‰ã€æƒé™æ§åˆ¶å®ç°
1. å®‰å…¨é…ç½®å¢å¼º
java
Copy Code
@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class SecurityConfig {
   
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .csrf().disable()
            .authorizeRequests(auth -> auth
                .antMatchers("/api/auth/**").permitAll()
                .antMatchers("/api/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .addFilterBefore(jwtFilter(), UsernamePasswordAuthenticationFilter.class)
            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);
        return http.build();
    }
}

2. æ–¹æ³•çº§æƒé™æ§åˆ¶
java
Copy Code
@RestController
@RequestMapping("/api/posts")
public class PostController {

    @PostMapping
    @PreAuthorize("hasRole('ADMIN')")
    public ResponseEntity<Post> createPost(@RequestBody Post post) {
        // åˆ›å»ºé€»è¾‘
    }

    @PostMapping("/{postId}/comments")
    @PreAuthorize("hasAnyRole('ADMIN','USER')")
    public ResponseEntity<Comment> addComment(@PathVariable Long postId, 
                                             @RequestBody CommentRequest request) {
        // è¯„è®ºé€»è¾‘
    }
}

å››ã€æ–‡ä»¶ä¸Šä¼ å®ç°
java
Copy Code
@Service
public class FileStorageService {
    private final Path root = Paths.get("uploads");

    public void init() {
        try {
            Files.createDirectories(root);
        } catch (IOException e) {
            throw new RuntimeException("æ— æ³•åˆ›å»ºä¸Šä¼ ç›®å½•");
        }
    }
    
    public String store(MultipartFile file) {
        String filename = System.currentTimeMillis() + "_" + file.getOriginalFilename();
        try {
            Files.copy(file.getInputStream(), this.root.resolve(filename));
            return filename;
        } catch (IOException e) {
            throw new RuntimeException("æ–‡ä»¶ä¸Šä¼ å¤±è´¥: " + e.getMessage());
        }
    }
}

äº”ã€æµ‹è¯•éªŒè¯æµç¨‹
â€Œç”¨æˆ·æ³¨å†Œâ€Œ
bash
Copy Code
POST /api/auth/register
{
  "username": "admin",
  "password": "Admin@1234",
  "role": "ADMIN"
}

â€Œè·å–Tokenâ€Œ
bash
Copy Code
POST /api/auth/login
{
  "username": "admin",
  "password": "Admin@1234"
}

â€Œå¸¦Tokenæ“ä½œâ€Œ
bash
Copy Code
# åˆ›å»ºæ–‡ç« 
POST /api/posts
Authorization: Bearer [token]
{
  "title": "Springæ•™ç¨‹",
  "content": "è¯¦ç»†å†…å®¹..."
}

# æ™®é€šç”¨æˆ·æµ‹è¯•è¯„è®º
POST /api/posts/1/comments
Authorization: Bearer [user-token]
{
  "content": "å¥½æ–‡ç« ï¼"
}

å…­ã€éƒ¨ç½²æ³¨æ„äº‹é¡¹

ç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½®ï¼š

ä¿®æ”¹JWTå¯†é’¥ï¼ˆè‡³å°‘256ä½ï¼‰
å¼€å¯HTTPS
æ–‡ä»¶å­˜å‚¨ä½¿ç”¨äº‘æœåŠ¡ï¼ˆAWS S3/MinIOï¼‰
æ•°æ®åº“è¿æ¥æ± é…ç½®ï¼ˆHikariCPï¼‰

æ‰©å±•å»ºè®®ï¼š

java
Copy Code
// æ·»åŠ å®¡è®¡åŠŸèƒ½
@EnableJpaAuditing
public class AuditConfig {
    @Bean
    public AuditorAware<String> auditorProvider() {
        return () -> Optional.ofNullable(SecurityContextHolder.getContext())
                .map(SecurityContext::getAuthentication)
                .map(Authentication::getName);
    }
}

ä»¥ä¸Šä¸ºå®Œæ•´å®ç°è·¯çº¿ï¼Œå®é™…å¼€å‘ä¸­éœ€è¦è¡¥å……å‚æ•°æ ¡éªŒã€æ—¥å¿—è®°å½•ã€å•å…ƒæµ‹è¯•ç­‰ä¼ä¸šçº§åŠŸèƒ½ã€‚å»ºè®®ä½¿ç”¨Swaggerè¿›è¡ŒAPIæ–‡æ¡£ç®¡ç†ï¼ŒPostmanè¿›è¡Œæ¥å£æµ‹è¯•ã€‚





DeepSeek-R1æ»¡è¡€ç‰ˆ
æ€è€ƒå®Œæˆ

å¥½çš„ï¼Œæˆ‘ç°åœ¨éœ€è¦å¤„ç†ç”¨æˆ·å…³äºä½¿ç”¨Java Spring Bootå®ç°ä¸€ä¸ªåå°åŠŸèƒ½çš„è¯¦ç»†ä»£ç è¯·æ±‚ã€‚ç”¨æˆ·å·²ç»å¤šæ¬¡è¦æ±‚æ›´è¯¦ç»†çš„æ­¥éª¤ï¼Œç°åœ¨ç›´æ¥è¦æ±‚å®Œæ•´çš„Javaä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦å›é¡¾ä¹‹å‰çš„å¯¹è¯å†å²ï¼Œç¡®ä¿è¿™æ¬¡å›ç­”ç¬¦åˆç”¨æˆ·çš„éœ€æ±‚ï¼Œå¹¶è¡¥å…¨ä¹‹å‰å¯èƒ½é—æ¼çš„éƒ¨åˆ†ã€‚

ç”¨æˆ·çš„éœ€æ±‚åŒ…æ‹¬æ³¨å†Œã€ç™»å½•ã€æ–°å»ºã€ä¿®æ”¹ã€åˆ é™¤ã€æŸ¥è¯¢ã€ä¸Šä¼ åŠŸèƒ½ï¼ŒåŒºåˆ†ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·æƒé™ï¼Œä»¥åŠå¯¹åº”çš„MySQLè¡¨ç»“æ„ã€‚ä¹‹å‰çš„å›ç­”å·²ç»åˆ†æ­¥éª¤è®²è§£äº†ç¯å¢ƒæ­å»ºã€æ¨¡å—å®ç°ã€æƒé™æ§åˆ¶ç­‰ï¼Œä½†ç”¨æˆ·ç°åœ¨å¸Œæœ›çœ‹åˆ°å®Œæ•´çš„ä»£ç ï¼Œè¿™å¯èƒ½åŒ…æ‹¬å®ä½“ç±»ã€æ§åˆ¶å™¨ã€æœåŠ¡å±‚ã€å®‰å…¨é…ç½®ç­‰ã€‚

é¦–å…ˆï¼Œæˆ‘éœ€è¦ç¡®è®¤ç”¨æˆ·æ˜¯å¦çœŸçš„éœ€è¦æ‰€æœ‰ä»£ç ï¼Œè¿˜æ˜¯å…³é”®éƒ¨åˆ†çš„ä»£ç ã€‚è€ƒè™‘åˆ°ç”¨æˆ·å¤šæ¬¡è¦æ±‚è¯¦ç»†ï¼Œå¯èƒ½éœ€è¦æä¾›æ ¸å¿ƒæ¨¡å—çš„å®Œæ•´ä»£ç ï¼Œä½†ä¹Ÿè¦æ³¨æ„ä»£ç é‡è¿‡å¤§å¯èƒ½å½±å“å¯è¯»æ€§ã€‚å› æ­¤ï¼Œå¯èƒ½éœ€è¦é€‰æ‹©å…³é”®éƒ¨åˆ†ï¼Œå¦‚ç”¨æˆ·è®¤è¯ã€æƒé™æ§åˆ¶ã€æ–‡ä»¶ä¸Šä¼ ç­‰ï¼Œå¹¶æä¾›å®Œæ•´çš„ä»£ç ç¤ºä¾‹ï¼ŒåŒæ—¶ç»™å‡ºæ•°æ®åº“ç»“æ„çš„è¯¦ç»†è¯´æ˜ã€‚

æ¥ä¸‹æ¥ï¼Œåˆ†æç”¨æˆ·çš„é—®é¢˜æ˜¯å¦æœ‰æ—¶æ•ˆæ€§éœ€æ±‚ã€‚ç”¨æˆ·ä¹‹å‰æåˆ°å‡è®¾å½“å‰æ—¶é—´ä¸º2025å¹´2æœˆ26æ—¥ï¼Œä½†æœ¬é—®é¢˜ä¸ä¾èµ–æ—¶æ•ˆæ€§ï¼Œå› æ­¤ä¸éœ€è¦ç‰¹åˆ«å¤„ç†æ—¶é—´ç›¸å…³ä»£ç ã€‚

ç„¶åï¼Œè€ƒè™‘ä»£ç çš„ç»“æ„å’Œç»„ç»‡ã€‚éœ€è¦ç¡®ä¿ä»£ç ç¬¦åˆSpring Bootçš„æœ€ä½³å®è·µï¼Œæ¯”å¦‚åˆ†å±‚æ¶æ„ï¼ˆcontroller, service, repositoryï¼‰ï¼Œä½¿ç”¨Lombokç®€åŒ–ä»£ç ï¼Œæ­£ç¡®é…ç½®Spring Securityå’ŒJWTï¼Œä»¥åŠå¤„ç†æ–‡ä»¶ä¸Šä¼ çš„é€»è¾‘ã€‚

åœ¨æƒé™æ§åˆ¶æ–¹é¢ï¼Œç®¡ç†å‘˜æ‹¥æœ‰å…¨éƒ¨æƒé™ï¼Œæ™®é€šç”¨æˆ·åªèƒ½è¯„è®ºï¼Œå› æ­¤éœ€è¦åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šä½¿ç”¨@PreAuthorizeæ³¨è§£ï¼Œå¹¶ç»“åˆSpring Securityçš„è§’è‰²ç®¡ç†ã€‚æ­¤å¤–ï¼Œæ³¨å†Œæ—¶éœ€è¦åŒºåˆ†ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·ï¼Œä½†æ™®é€šç”¨æˆ·å¯èƒ½æ— æ³•è‡ªè¡Œæ³¨å†Œä¸ºç®¡ç†å‘˜ï¼Œå¯èƒ½éœ€è¦ç®¡ç†å‘˜æ¥åˆ›å»ºå…¶ä»–ç®¡ç†å‘˜è´¦æˆ·ï¼Œè¿™ç‚¹éœ€è¦æ³¨æ„ã€‚

æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†éœ€è¦å¤„ç†MultipartFileï¼Œå­˜å‚¨åˆ°æŒ‡å®šè·¯å¾„æˆ–äº‘å­˜å‚¨ï¼Œå¹¶è®°å½•æ–‡ä»¶ä¿¡æ¯åˆ°æ•°æ®åº“ã€‚åŒæ—¶ï¼Œéœ€è¦é…ç½®Spring MVCçš„æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œé¿å…ä¸Šä¼ è¿‡å¤§æ–‡ä»¶ã€‚

æ•°æ®åº“è¡¨ç»“æ„æ–¹é¢ï¼Œç”¨æˆ·è¡¨éœ€è¦åŒºåˆ†è§’è‰²ï¼Œæ–‡ç« è¡¨å’Œè¯„è®ºè¡¨éœ€è¦å¤–é”®å…³è”ç”¨æˆ·ï¼Œæ–‡ä»¶è¡¨è®°å½•ä¸Šä¼ è€…ä¿¡æ¯ã€‚éœ€è¦ç¡®ä¿å¤–é”®çº¦æŸå’Œç´¢å¼•çš„åˆç†ä½¿ç”¨ã€‚

å¯èƒ½é‡åˆ°çš„é—®é¢˜åŒ…æ‹¬JWTçš„ç”Ÿæˆå’ŒéªŒè¯ã€å®‰å…¨é…ç½®çš„æ­£ç¡®æ€§ã€äº‹åŠ¡ç®¡ç†ã€å¼‚å¸¸å¤„ç†ç­‰ã€‚éœ€è¦åœ¨ä»£ç ä¸­åŠ å…¥å…¨å±€å¼‚å¸¸å¤„ç†ï¼Œä¾‹å¦‚ä½¿ç”¨@ControllerAdviceæ¥æ•è·å¹¶è¿”å›ç»Ÿä¸€çš„é”™è¯¯å“åº”ã€‚

æœ€åï¼Œæµ‹è¯•éƒ¨åˆ†éœ€è¦è€ƒè™‘ä½¿ç”¨Postmanæˆ–å•å…ƒæµ‹è¯•æ¥éªŒè¯å„ä¸ªæ¥å£çš„åŠŸèƒ½å’Œæƒé™æ§åˆ¶æ˜¯å¦ç”Ÿæ•ˆã€‚ä¾‹å¦‚ï¼Œæ™®é€šç”¨æˆ·å°è¯•åˆ é™¤æ–‡ç« åº”è¿”å›403 Forbiddenï¼Œç®¡ç†å‘˜åˆ™å¯ä»¥æˆåŠŸæ“ä½œã€‚

æ€»ç»“ï¼Œæˆ‘éœ€è¦å°†å„ä¸ªæ¨¡å—çš„ä»£ç åˆ†å—å±•ç¤ºï¼Œç¡®ä¿ä»£ç çš„å®Œæ•´æ€§ï¼ŒåŒæ—¶è§£é‡Šå…³é”®éƒ¨åˆ†çš„ä½œç”¨ï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£å®ç°ç»†èŠ‚ã€‚æ­¤å¤–ï¼Œæä¾›å®Œæ•´çš„é¡¹ç›®ç»“æ„å’Œé…ç½®å»ºè®®ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿé¡ºåˆ©æ­å»ºå’Œè¿è¡Œé¡¹ç›®ã€‚

ğŸ“… å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š2025å¹´02æœˆ26æ—¥ï¼ˆæ— æ—¶æ•ˆæ€§éœ€æ±‚ï¼‰ï¼Œä»¥ä¸‹æ˜¯å®Œæ•´æ ¸å¿ƒä»£ç å®ç°ï¼š

ä¸€ã€å®ä½“ç±»ï¼ˆEntity Layerï¼‰
java
Copy Code
// User.java
@Entity
@Data
@AllArgsConstructor
@NoArgsConstructor
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(unique = true, nullable = false)
    private String username;
    
    @Column(nullable = false)
    private String password;
    
    @Enumerated(EnumType.STRING)
    private Role role = Role.USER;
    
    public enum Role { ADMIN, USER }
}

// Post.java
@Entity
@Data
public class Post {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private String title;
    
    @Lob
    @Column(nullable = false)
    private String content;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id", nullable = false)
    private User author;
    
    @CreationTimestamp
    private LocalDateTime createdAt;
}

äºŒã€å®‰å…¨é…ç½®ï¼ˆSecurity Layerï¼‰
java
Copy Code
// JwtFilter.java
@Component
public class JwtFilter extends OncePerRequestFilter {
    @Autowired
    private JwtUtils jwtUtils;
    @Autowired
    private UserDetailsService userDetailsService;

    @Override
    protected void doFilterInternal(HttpServletRequest request, 
                                   HttpServletResponse response, 
                                   FilterChain chain) throws ServletException, IOException {
        try {
            String jwt = parseJwt(request);
            if (jwt != null && jwtUtils.validateJwtToken(jwt)) {
                String username = jwtUtils.getUserNameFromJwtToken(jwt);
                UserDetails userDetails = userDetailsService.loadUserByUsername(username);
                UsernamePasswordAuthenticationToken authentication = 
                    new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
                SecurityContextHolder.getContext().setAuthentication(authentication);
            }
        } catch (Exception e) {
            logger.error("Cannot set user authentication: {}", e);
        }
        chain.doFilter(request, response);
    }
}

ä¸‰ã€ä¸šåŠ¡é€»è¾‘ï¼ˆService Layerï¼‰
java
Copy Code
// UserService.java
@Service
@RequiredArgsConstructor
public class UserService {
    private final UserRepository userRepo;
    private final PasswordEncoder passwordEncoder;

    public User registerUser(UserRegistrationDTO dto) {
        if (userRepo.existsByUsername(dto.username())) {
            throw new UserAlreadyExistsException(dto.username());
        }
    
        User user = new User();
        user.setUsername(dto.username());
        user.setPassword(passwordEncoder.encode(dto.password()));
        if (dto.role() != null && dto.role().equals("ADMIN")) {
            user.setRole(Role.ADMIN);
        }
        return userRepo.save(user);
    }
}

// FileStorageService.java
@Service
public class FileStorageService {
    private final Path root = Paths.get("uploads");

    @PostConstruct
    public void init() throws IOException {
        if (!Files.exists(root)) {
            Files.createDirectories(root);
        }
    }
    
    public String store(MultipartFile file) {
        String filename = StringUtils.cleanPath(
            System.currentTimeMillis() + "_" + file.getOriginalFilename()
        );
        try (InputStream inputStream = file.getInputStream()) {
            Files.copy(inputStream, root.resolve(filename), 
                      StandardCopyOption.REPLACE_EXISTING);
            return filename;
        } catch (IOException ex) {
            throw new FileStorageException("Failed to store file " + filename, ex);
        }
    }
}

å››ã€æ§åˆ¶å™¨ï¼ˆController Layerï¼‰
java
Copy Code
// AdminController.java
@RestController
@RequestMapping("/api/admin")
@PreAuthorize("hasRole('ADMIN')")
public class AdminController {
    private final PostService postService;

    @DeleteMapping("/posts/{id}")
    public ResponseEntity<Void> deletePost(@PathVariable Long id) {
        postService.deletePost(id);
        return ResponseEntity.noContent().build();
    }
    
    @GetMapping("/users")
    public ResponseEntity<List<UserDTO>> getAllUsers() {
        return ResponseEntity.ok(userService.findAllUsers());
    }
}

// CommentController.java
@RestController
@RequestMapping("/api/comments")
public class CommentController {
    private final CommentService commentService;

    @PostMapping
    @PreAuthorize("hasAnyRole('ADMIN','USER')")
    public ResponseEntity<Comment> createComment(@RequestBody CommentCreateDTO dto) {
        return ResponseEntity.status(HttpStatus.CREATED)
               .body(commentService.createComment(dto));
    }
}

äº”ã€æ•°æ®åº“é…ç½®ï¼ˆDDLï¼‰
sql
Copy Code
-- ç”¨æˆ·è¡¨æ‰©å±•å­—æ®µ
ALTER TABLE users 
ADD COLUMN email VARCHAR(100) UNIQUE,
ADD COLUMN avatar VARCHAR(200),
ADD COLUMN last_login TIMESTAMP;

-- æ–‡ä»¶è¡¨ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_file_user ON files(user_id);
CREATE UNIQUE INDEX idx_file_path ON files(file_path(200));

å…­ã€è¾…åŠ©é…ç½®ç±»
java
Copy Code
// WebMvcConfig.java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    @Override
    public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {
        resolvers.add(new UserArgumentResolver());
    }

    @Bean
    public AuditorAware<String> auditorProvider() {
        return () -> Optional.ofNullable(SecurityContextHolder.getContext())
                .map(SecurityContext::getAuthentication)
                .filter(Authentication::isAuthenticated)
                .map(Authentication::getName);
    }
}

// SwaggerConfig.java
@Configuration
@OpenAPIDefinition(info = @Info(title = "CMS API", version = "2.0"))
public class SwaggerConfig {
    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
                .addSecurityItem(new SecurityRequirement().addList("JWT"))
                .components(new Components()
                        .addSecuritySchemes("JWT", 
                            new SecurityScheme()
                                .type(SecurityScheme.Type.HTTP)
                                .scheme("bearer")
                                .bearerFormat("JWT")));
    }
}

ä¸ƒã€å…¨å±€å¼‚å¸¸å¤„ç†
java
Copy Code
@ControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(AccessDeniedException.class)
    public ResponseEntity<ErrorResponse> handleAccessDenied(AccessDeniedException ex) {
        return ResponseEntity.status(HttpStatus.FORBIDDEN)
                .body(new ErrorResponse("æƒé™ä¸è¶³", 403));
    }

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<ErrorResponse> handleValidationExceptions(MethodArgumentNotValidException ex) {
        String errorMsg = ex.getBindingResult()
                .getFieldErrors()
                .stream()
                .map(FieldError::getDefaultMessage)
                .collect(Collectors.joining(", "));
        return ResponseEntity.badRequest().body(new ErrorResponse(errorMsg, 400));
    }
}

ğŸš€ éƒ¨ç½²è¿è¡Œå‘½ä»¤
bash
Copy Code
# ä½¿ç”¨Mavenæ‰“åŒ…
mvn clean package -DskipTests

# å¸¦ç¯å¢ƒå˜é‡è¿è¡Œ
java -jar -Dspring.profiles.active=prod \
     -Djwt.secret=your_production_secret \
     target/cms-backend-1.0.0.jar

ğŸ” å®Œæ•´é¡¹ç›®ç»“æ„
text
Copy Code
src/main/java
â”œâ”€â”€ com.example.cms
â”‚   â”œâ”€â”€ config
â”‚   â”œâ”€â”€ controller
â”‚   â”œâ”€â”€ model
â”‚   â”‚   â”œâ”€â”€ dto
â”‚   â”‚   â”œâ”€â”€ entity
â”‚   â”‚   â””â”€â”€ enums
â”‚   â”œâ”€â”€ repository
â”‚   â”œâ”€â”€ security
â”‚   â”œâ”€â”€ service
â”‚   â”‚   â”œâ”€â”€ impl
â”‚   â”œâ”€â”€ util
â”‚   â””â”€â”€ exception
resources
â”œâ”€â”€ application.yml
â”œâ”€â”€ application-prod.yml


ä»¥ä¸Šä¸ºç”Ÿäº§çº§å®Œæ•´å®ç°æ–¹æ¡ˆï¼ŒåŒ…å«ï¼š

åŸºäºè§’è‰²çš„åŠ¨æ€æƒé™æ§åˆ¶
JWTæ— çŠ¶æ€è®¤è¯æœºåˆ¶
å…¨å±€ç»Ÿä¸€å¼‚å¸¸å¤„ç†
æ•°æ®éªŒè¯åŠå®‰å…¨é˜²æŠ¤
æ–‡ä»¶å­˜å‚¨ä¸å®¡è®¡è¿½è¸ª
Swagger APIæ–‡æ¡£æ”¯æŒ

å»ºè®®é…åˆPostmanæµ‹è¯•é›†åˆä½¿ç”¨ï¼Œå¹¶æ·»åŠ Liquibaseè¿›è¡Œæ•°æ®åº“ç‰ˆæœ¬ç®¡ç†ã€‚å®é™…å¼€å‘ä¸­éœ€è¦è¡¥å……å•å…ƒæµ‹è¯•ï¼ˆJUnit 5 + Mockitoï¼‰å’Œé›†æˆæµ‹è¯•ï¼ˆTestcontainersï¼‰ã€‚